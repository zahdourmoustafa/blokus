<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  lang="fr"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Partie en cours - Blokus</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .navbar {
        background-color: #5c6bc0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .navbar-brand,
      .nav-link {
        color: white !important;
      }
      .content-section {
        padding: 20px 0;
      }
      .game-info {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        padding: 15px;
        margin-bottom: 20px;
      }
      .game-board {
        display: grid;
        grid-template-columns: repeat(20, 1fr);
        grid-template-rows: repeat(20, 1fr);
        gap: 1px;
        background-color: #e0e0e0;
        border: 1px solid #aaa;
        width: 100%;
        max-width: 600px;
        aspect-ratio: 1/1;
        margin: 0 auto;
      }
      .cell {
        background-color: white;
        border: 1px solid #ddd;
        width: 100%;
        height: 0;
        padding-bottom: 100%;
        position: relative;
        cursor: pointer;
      }
      .cell:hover {
        background-color: #f5f5f5;
      }
      .player-info {
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 10px;
        color: white;
      }
      .player-blue {
        background-color: #1e88e5;
      }
      .player-red {
        background-color: #e53935;
      }
      .player-yellow {
        background-color: #fdd835;
        color: #333;
      }
      .player-green {
        background-color: #43a047;
      }
      .player-ai {
        opacity: 0.8;
      }
      .pieces-container {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        padding: 15px;
        height: 100%;
      }
      .cell-blue {
        background-color: #1e88e5;
      }
      .cell-red {
        background-color: #e53935;
      }
      .cell-yellow {
        background-color: #fdd835;
      }
      .cell-green {
        background-color: #43a047;
      }
      .starting-corner-bl {
        background-color: rgba(30, 136, 229, 0.3);
      }
      .starting-corner-br {
        background-color: rgba(229, 57, 53, 0.3);
      }
      .starting-corner-tr {
        background-color: rgba(253, 216, 53, 0.3);
      }
      .starting-corner-tl {
        background-color: rgba(67, 160, 71, 0.3);
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" th:href="@{/}">Blokus</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" th:href="@{/}">Accueil</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" th:href="@{/parties}">Parties</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Profil</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" th:href="@{/logout}">Déconnexion</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Content Section -->
    <section class="content-section">
      <div class="container">
        <div
          class="alert alert-success"
          th:if="${successMessage}"
          th:text="${successMessage}"
        ></div>
        <div
          class="alert alert-danger"
          th:if="${errorMessage}"
          th:text="${errorMessage}"
        ></div>

        <div class="game-info">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0" th:text="${partie.nom}">Nom de la partie</h4>
            <span class="badge bg-success">En cours</span>
          </div>
          <p>
            <strong>Mode :</strong>
            <span th:if="${partie.mode.name() == 'CLASSIQUE'}">Classique</span>
            <span th:if="${partie.mode.name() == 'CHRONOMETRE'}"
              >Chronométré</span
            >
          </p>
        </div>

        <div class="row">
          <div class="col-md-3">
            <div class="pieces-container">
              <h5 class="mb-3">Joueurs</h5>
              <div
                th:each="participant : ${partie.participants}"
                th:class="${'player-info ' + 
                                       (participant.couleur.name() == 'BLEU' ? 'player-blue' : 
                                        participant.couleur.name() == 'ROUGE' ? 'player-red' : 
                                        participant.couleur.name() == 'JAUNE' ? 'player-yellow' : 
                                        'player-green') + 
                                       (participant.typeJoueur.name() == 'IA' ? ' player-ai' : '')}"
              >
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6
                      class="mb-0"
                      th:text="${participant.typeJoueur.name() == 'HUMAIN' ? participant.user.username : 'IA'}"
                    >
                      Nom du joueur
                    </h6>
                    <small th:if="${participant.typeJoueur.name() == 'IA'}"
                      >(Intelligence Artificielle)</small
                    >
                  </div>
                  <div>
                    <i
                      class="fas fa-robot"
                      th:if="${participant.typeJoueur.name() == 'IA'}"
                    ></i>
                    <i
                      class="fas fa-user"
                      th:if="${participant.typeJoueur.name() == 'HUMAIN'}"
                    ></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="game-board" id="gameBoard">
              <!-- La grille 20x20 sera générée par JavaScript -->
            </div>
          </div>
          <div class="col-md-3">
            <div class="pieces-container">
              <h5 class="mb-3">Vos pièces</h5>
              <p>Sélectionnez une pièce pour la placer sur le plateau</p>
              <div class="text-center mt-4">
                <p>Fonctionnalité en cours de développement</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const gameBoard = document.getElementById("gameBoard");

        // Créer la grille 20x20
        for (let row = 0; row < 20; row++) {
          for (let col = 0; col < 20; col++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.row = row;
            cell.dataset.col = col;

            // Marquer les coins de départ
            if (row === 0 && col === 0) {
              cell.classList.add("starting-corner-tl"); // Coin haut gauche
            } else if (row === 0 && col === 19) {
              cell.classList.add("starting-corner-tr"); // Coin haut droit
            } else if (row === 19 && col === 0) {
              cell.classList.add("starting-corner-bl"); // Coin bas gauche
            } else if (row === 19 && col === 19) {
              cell.classList.add("starting-corner-br"); // Coin bas droit
            }

            cell.addEventListener("click", function () {
              // Gérer le clic sur la cellule (à implémenter plus tard)
              console.log(`Cellule cliquée: rangée ${row}, colonne ${col}`);
            });

            gameBoard.appendChild(cell);
          }
        }
      });
    </script>
  </body>
</html>
